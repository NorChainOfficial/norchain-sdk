# NorChain Monorepo - Cursor Rules & Memory

## ğŸ¯ Project Context

You are working on the **NorChain Ecosystem Monorepo** - a comprehensive blockchain platform with:
- **Unified API** (NestJS) - Backend API for all services
- **Explorer** (Next.js) - Blockchain explorer frontend
- **NEX Exchange** (Next.js) - Decentralized exchange platform
- **Wallet** (Next.js) - Web-based cryptocurrency wallet
- **Mobile Apps** - Android (Kotlin) and iOS (Swift) wallets
- **Documentation** (Nextra) - Developer documentation site
- **Shared Packages** - SDK, Design System, Wallet Core (Rust)

## ğŸ—ï¸ Architecture Principles

### Core Principles
- **API-First**: All frontend apps consume the Unified API
- **SOLID Principles**: Apply consistently across all code
- **Type Safety**: Full TypeScript with strict mode
- **Modular Design**: Feature-based module organization
- **Clean Architecture**: Separation of concerns (Controllers â†’ Services â†’ Repositories â†’ Entities)

### Technology Stack
- **Backend**: NestJS 10, TypeScript, PostgreSQL, Redis
- **Frontend**: Next.js 14, TypeScript, Tailwind CSS
- **Mobile**: Kotlin (Android), Swift (iOS)
- **Native Core**: Rust (via FFI)
- **Infrastructure**: Docker, Docker Compose

## ğŸ“ File Organization Rules

### âš ï¸ CRITICAL: Do NOT Store Files in Root

**NEVER create or store these file types in the root directory:**
- âŒ Markdown files (`.md`) - Move to `docs/` or appropriate subdirectory
- âŒ Script files (`.sh`, `.js`) - Move to `scripts/` directory
- âŒ Status/Progress reports - Move to `docs/status/` or `docs/reports/`
- âŒ Testing reports - Move to `docs/testing/` or app-specific `test/` directories
- âŒ Build/deployment reports - Move to `docs/deployment/`

### Proper File Structure

```
norchain-monorepo/
â”œâ”€â”€ README.md                    # âœ… Main project README (ONLY root MD file)
â”œâ”€â”€ package.json                 # âœ… Root package.json
â”œâ”€â”€ docker-compose.yml           # âœ… Root docker-compose
â”œâ”€â”€ .cursorrules                 # âœ… This file
â”‚
â”œâ”€â”€ docs/                        # âœ… ALL documentation
â”‚   â”œâ”€â”€ architecture/           # Architecture docs
â”‚   â”œâ”€â”€ deployment/             # Deployment guides
â”‚   â”œâ”€â”€ development/            # Development guides
â”‚   â”œâ”€â”€ implementation/         # Implementation docs
â”‚   â”œâ”€â”€ product/                # Product docs
â”‚   â”œâ”€â”€ status/                 # Status reports (moved from root)
â”‚   â”œâ”€â”€ reports/                # Analysis reports (moved from root)
â”‚   â”œâ”€â”€ testing/                # Testing documentation
â”‚   â””â”€â”€ README.md               # Documentation index
â”‚
â”œâ”€â”€ scripts/                     # âœ… ALL scripts
â”‚   â”œâ”€â”€ build/                  # Build scripts
â”‚   â”œâ”€â”€ deployment/             # Deployment scripts
â”‚   â”œâ”€â”€ testing/                # Test scripts
â”‚   â””â”€â”€ setup/                  # Setup scripts
â”‚
â”œâ”€â”€ apps/                       # âœ… Application code
â”‚   â”œâ”€â”€ api/                    # Unified API
â”‚   â”‚   â”œâ”€â”€ src/                # Source code
â”‚   â”‚   â”œâ”€â”€ docs/               # API-specific docs
â”‚   â”‚   â”œâ”€â”€ scripts/            # API-specific scripts
â”‚   â”‚   â””â”€â”€ README.md           # API README
â”‚   â”œâ”€â”€ explorer/               # Explorer app
â”‚   â”œâ”€â”€ wallet/                 # Wallet app
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ packages/                    # âœ… Shared packages
    â”œâ”€â”€ sdk/                    # SDK package
    â”œâ”€â”€ design-system/          # Design system
    â””â”€â”€ wallet-core/            # Rust wallet core
```

### When Creating New Files

**Before creating any file, ask:**
1. **Is this a markdown file?** â†’ Move to `docs/` or appropriate subdirectory
2. **Is this a script?** â†’ Move to `scripts/` or app-specific `scripts/` directory
3. **Is this a status/report?** â†’ Move to `docs/status/` or `docs/reports/`
4. **Is this app-specific?** â†’ Place in the app's directory

**Root directory should ONLY contain:**
- `README.md` (main project README)
- `package.json` (root package.json)
- `docker-compose.yml` (root docker-compose)
- `.cursorrules` (this file)
- `.gitignore`
- Configuration files (`.env.example`, `tsconfig.json`, etc.)

## ğŸ’» Coding Standards

### TypeScript & JavaScript
- **Always use TypeScript** for new code
- **Strict mode enabled** - No `any` types without justification
- **Use interfaces** for object shapes
- **Use types** for unions, intersections, and computed types
- **Prefer `const`** over `let`, avoid `var`
- **Use async/await** instead of promises chains
- **Destructure** when accessing multiple properties

### Code Organization
- **Keep files under 200-300 lines** - Refactor if exceeded
- **Single Responsibility Principle** - One class/function per file
- **Avoid code duplication** - Extract shared logic
- **Use meaningful names** - Descriptive variable and function names
- **Add JSDoc comments** for public APIs and complex logic

### NestJS Patterns
- **Module Structure**: `dto/`, `entities/`, `repositories/`, `services/`, `controllers/`
- **Use DTOs** for all request/response validation
- **Use Guards** for authentication/authorization
- **Use Interceptors** for transformation and logging
- **Use Filters** for exception handling
- **Dependency Injection** - Use constructor injection

### React/Next.js Patterns
- **Server Components** by default (Next.js 14)
- **Client Components** only when needed (`'use client'`)
- **Component Structure**: Co-locate components with pages
- **Hooks**: Custom hooks for reusable logic
- **State Management**: Zustand for global state, React Query for server state
- **Styling**: Tailwind CSS utility classes

### Error Handling
- **Always handle errors** - Use try/catch or error boundaries
- **Provide meaningful error messages** - Include context
- **Log errors** - Use structured logging (Winston for API, console for frontend)
- **Return proper HTTP status codes** - 400, 401, 403, 404, 500, etc.
- **Use global exception filters** (NestJS) or error boundaries (React)

## ğŸ§ª Testing Guidelines

### Test Coverage Target: 80%+
- **Unit Tests**: Test services, utilities, and business logic
- **Integration Tests**: Test database, Redis, external services
- **E2E Tests**: Test complete user flows
- **Controller Tests**: Test HTTP endpoints and validation

### Test Organization
- **Unit tests**: Co-located with source files (`*.spec.ts`)
- **Integration tests**: `*.integration.spec.ts` in test directories
- **E2E tests**: `test/` directory at app root
- **Test utilities**: `test/utils/` or `test/helpers/`

### Testing Best Practices
- **Test behavior, not implementation** - Focus on what, not how
- **Use descriptive test names** - `describe` and `it` should be clear
- **Mock external dependencies** - Don't hit real APIs/databases in unit tests
- **Test edge cases** - Empty inputs, null values, error conditions
- **Keep tests fast** - Unit tests should be < 100ms each

## ğŸ”’ Security Guidelines

### Authentication & Authorization
- **JWT tokens** for API authentication
- **API keys** as alternative authentication method
- **Role-based access control** (RBAC) where needed
- **Never expose private keys** - Client-side signing only

### Data Security
- **Validate all inputs** - Use DTOs with class-validator
- **Sanitize user input** - Prevent XSS and injection attacks
- **Use parameterized queries** - TypeORM handles SQL injection prevention
- **Encrypt sensitive data** - Use Keychain (iOS) or Keystore (Android)

### Environment Variables
- **Never commit `.env` files** - Use `.env.example` instead
- **Document all environment variables** - In README or docs
- **Use strong secrets** - Generate secure random strings
- **Different secrets per environment** - Dev, test, prod

## ğŸš€ Performance Guidelines

### API Performance
- **Use Redis caching** - Cache frequently accessed data
- **Implement pagination** - For list endpoints
- **Optimize database queries** - Use indexes, avoid N+1 queries
- **Use connection pooling** - Configure TypeORM pool size
- **Compress responses** - Enable gzip compression

### Frontend Performance
- **Code splitting** - Use Next.js dynamic imports
- **Image optimization** - Use Next.js Image component
- **Lazy loading** - Load components and data on demand
- **Memoization** - Use React.memo, useMemo, useCallback appropriately
- **Bundle analysis** - Monitor bundle size

## ğŸ“ Documentation Standards

### Code Documentation
- **JSDoc comments** for public APIs, complex functions, and classes
- **Inline comments** for non-obvious logic (explain why, not what)
- **README.md** in each app/package directory
- **Type definitions** - Self-documenting with TypeScript

### Documentation Files
- **Architecture docs** â†’ `docs/architecture/`
- **API docs** â†’ `apps/api/docs/` or Swagger
- **Deployment docs** â†’ `docs/deployment/`
- **Development guides** â†’ `docs/development/`
- **Status reports** â†’ `docs/status/`
- **Analysis reports** â†’ `docs/reports/`

### README Structure
Each README should include:
- Project description
- Quick start guide
- Installation instructions
- Configuration
- Usage examples
- API documentation (if applicable)
- Contributing guidelines

## ğŸ” Code Review Checklist

Before submitting code, ensure:
- âœ… No TypeScript/linting errors
- âœ… Tests written and passing
- âœ… Code follows SOLID principles
- âœ… Files are properly organized (not in root)
- âœ… Documentation updated
- âœ… Error handling implemented
- âœ… Security considerations addressed
- âœ… Performance optimizations applied (if needed)

## ğŸ¨ UI/UX Guidelines

### Design Principles
- **Apple Developer Standards** - Clean, elegant, intuitive UI
- **Modern & Professional** - Inspiring and eye-catching design
- **User-Friendly** - Intuitive navigation and interactions
- **Accessible** - Follow WCAG guidelines
- **Responsive** - Mobile-first approach

### Component Design
- **Reusable components** - Extract common UI patterns
- **Consistent styling** - Use design system tokens
- **Loading states** - Show loading indicators
- **Error states** - Display helpful error messages
- **Empty states** - Provide guidance when no data

## ğŸ³ Docker & Deployment

### Docker Best Practices
- **Multi-stage builds** - Optimize image size
- **Health checks** - Configure for all services
- **Environment variables** - Use env files, not hardcoded values
- **Non-root user** - Run containers as non-root when possible
- **Layer caching** - Order Dockerfile commands for optimal caching

### Deployment
- **Environment-specific configs** - Dev, test, prod
- **Health check endpoints** - `/api/v1/health`
- **Graceful shutdown** - Handle SIGTERM signals
- **Logging** - Structured logs for production
- **Monitoring** - Set up monitoring and alerting

## ğŸ”„ Git Workflow

### Commit Messages
- **Use conventional commits** - `feat:`, `fix:`, `docs:`, `refactor:`, etc.
- **Be descriptive** - Explain what and why
- **Reference issues** - Link to related issues/PRs

### Branch Strategy
- **main** - Production-ready code
- **develop** - Integration branch (if used)
- **feature/** - Feature branches
- **fix/** - Bug fix branches
- **docs/** - Documentation updates

## ğŸš« Common Mistakes to Avoid

1. **âŒ Creating files in root** - Always use proper directories
2. **âŒ Using `any` type** - Use proper types or `unknown`
3. **âŒ Ignoring errors** - Always handle errors properly
4. **âŒ Hardcoding values** - Use environment variables or config
5. **âŒ Skipping tests** - Write tests for new features
6. **âŒ Large files** - Refactor files over 200-300 lines
7. **âŒ Code duplication** - Extract shared logic
8. **âŒ Missing documentation** - Document public APIs
9. **âŒ Committing secrets** - Never commit `.env` files
10. **âŒ Breaking changes** - Maintain backward compatibility

## ğŸ“š Memory & Context

### Project Structure
- **Monorepo** - npm workspaces for package management
- **Unified API** - Single backend for all frontend apps
- **Shared Database** - PostgreSQL used by Unified API only
- **No direct DB access** - Frontend apps call API, never DB directly

### Key Endpoints
- **API Base**: `http://localhost:4000/api/v1` (external)
- **API Internal**: `http://api:3000/api/v1` (Docker network)
- **Swagger Docs**: `http://localhost:4000/api-docs`

### Port Configuration
- **API**: 4000 (external), 3000 (internal)
- **Explorer**: 4002 (external), 3002 (internal)
- **Landing**: 4010 (external), 3010 (internal)
- **NEX Exchange**: 4001 (external), 3001 (internal)
- **Wallet**: 4020 (external), 4020 (internal)
- **Docs**: 4011 (external), 3011 (internal)
- **PostgreSQL**: 5433 (external), 5432 (internal)
- **Redis**: 6380 (external), 6379 (internal)

### Development Commands
- **Run all**: `npm run dev` (parallel)
- **Run API**: `npm run api:dev`
- **Run Explorer**: `npm run explorer:dev`
- **Run NEX**: `npm run nex:dev`
- **Run Wallet**: `npm run wallet:dev`
- **Build all**: `npm run build`
- **Test all**: `npm run test`
- **Lint all**: `npm run lint`

### Important Notes
- **Never run `npm run dev`** - Focus on `npm run lint` and `npm run build` per user preference
- **Check existing code** - Before adding new components, search for similar functionality
- **Refactor when needed** - Keep code clean and organized
- **Environment-aware** - Code should work in dev, test, and prod
- **No mocking in prod** - Mocking only for tests, never in dev/prod code

## ğŸ¯ Quick Reference

### File Organization
- **Docs** â†’ `docs/` directory
- **Scripts** â†’ `scripts/` directory
- **App code** â†’ `apps/[app-name]/`
- **Shared code** â†’ `packages/[package-name]/`
- **Root** â†’ Only config files and main README

### Code Quality
- **TypeScript strict mode** âœ…
- **SOLID principles** âœ…
- **Test coverage 80%+** âš ï¸ (currently ~28-29%)
- **Files < 200-300 lines** âœ…
- **No code duplication** âœ…

### Before Making Changes
1. âœ… Analyze existing codebase for similar functionality
2. âœ… Check if code/component already exists
3. âœ… Understand architecture and patterns
4. âœ… Plan changes before implementing
5. âœ… Ensure proper file organization

---

**Last Updated**: January 2025  
**Maintained By**: Development Team

